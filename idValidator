// ==UserScript==
// @name ID validator
// @namespace all
// @description Checks if duplicate IDs in DOM excist and alert them
// @version 1.3
// ==/UserScript==

var findDuplicates = function() {
    var ids = {};
    var duplicates = {};
    var nodes = document.querySelectorAll('[id]');
    var nodes_count = nodes.length - 1;
    var nc = nodes_count;
    var start = Date.now();

    do {
        var idName = nodes.item(nodes_count).getAttribute('id');
        if (idName in ids) {
            if (idName in duplicates) {
                duplicates[idName] += 1;
            } else {
                duplicates[idName] = 2;
            }
        } else {
            ids[idName] = idName;
        }
    } while (nodes_count--);

    console.log("%d attributes scanned in %d ms", nc, (Date.now() - start));

    if (Object.getOwnPropertyNames(duplicates).length) {
        alert("Duplicates: " + duplicates.toSource());
    }
}

document.addEventListener('DOMContentLoaded', findDuplicates, false);
